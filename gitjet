#!/bin/bash

# ==============================
# Настройки
# ==============================
FIRST_COMMIT_MSG="initial commit"
BRANCH_NAME="master"
GIT_NAME="codesshaman"
GIT_MAIL="nicksemail@yandex.ru"

# ==============================
# Проверка аргументов
# ==============================
if [ $# -eq 0 ]; then
    echo "Ошибка: Укажите адрес удаленного репозитория как аргумент."
    echo "Пример: $0 https://github.com/user/repo.git"
    exit 1
fi

REMOTE_URL="$1"

# ==============================
# Определяем путь и директорию
# ==============================
read -p "Введите путь к локальной директории для инициализации репозитория (по умолчанию — текущая): " LOCAL_PATH
if [ -z "$LOCAL_PATH" ]; then
    LOCAL_PATH="$(pwd)"
fi

# Создание директории, если её нет
if [ ! -d "$LOCAL_PATH" ]; then
    mkdir -p "$LOCAL_PATH"
fi

# Извлекаем имя директории как предложение для имени проекта
DEFAULT_PROJECT_NAME="$(basename "$LOCAL_PATH")"

# ==============================
# Подтверждение имени проекта
# ==============================
read -p "Использовать '$DEFAULT_PROJECT_NAME' как имя проекта? [Y/n]: " CONFIRM

if [[ "$CONFIRM" =~ ^[Nn]$ ]]; then
    read -p "Введите имя проекта вручную: " PROJECT_NAME
else
    PROJECT_NAME="$DEFAULT_PROJECT_NAME"
fi

# ==============================
# Основная логика Git
# ==============================
cd "$LOCAL_PATH" || exit 1

git init

# Создаём README.md
echo "# $PROJECT_NAME" > README.md

git add README.md

# Настраиваем Git-пользователя
git config user.name "$GIT_NAME"
git config user.email "$GIT_MAIL"

# Проверяем конфигурацию
git config --local --list

# Первый коммит
git commit -m "$FIRST_COMMIT_MSG"

# Переименовываем ветку
git branch -M "$BRANCH_NAME"

# Добавляем удалённый репозиторий
git remote add origin "$REMOTE_URL"

# Пушим в основную ветку
git push -u origin "$BRANCH_NAME"

echo "✅ Репозиторий успешно инициализирован в '$LOCAL_PATH' с именем проекта '$PROJECT_NAME'."
